<!DOCTYPE html>
<html>

<head>
    <title>{% block title %}Vise{% endblock %}</title>    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block page_css %}
        <link rel="icon" type="image/ico" href="favicon.ico"/>
        <link href="/static/css2/bootstrap.min.css" rel="stylesheet">
        <link href="/static/css2/font-awesome/css/font-awesome.css" rel="stylesheet">
        <link href="/static/css2/animate.css" rel="stylesheet">
        <link href="/static/css2/style.css" rel="stylesheet">
        <link href="/static/css2/fsai.css" rel="stylesheet">
        <link href="/static/css2/stylesheets.css" rel="stylesheet" type="text/css"/>   
        <link href="/static/css2/stylesheet.css" rel="stylesheet" type="text/css"/>   
    {% endblock %}
    {% block head %}            
        <script type='text/javascript' src='/static/assets/js/plugins/jquery/jquery.min.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/jquery/jquery-ui.min.js'></script>   
        <script type='text/javascript' src='/static/assets/js/plugins/jquery/jquery-migrate.min.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/bootstrap/bootstrap.min.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/uniform/jquery.uniform.min.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/datatables/jquery.dataTables.min.js'></script>

        <script type='text/javascript' src='/static/assets/js/plugins/uniform/jquery.uniform.min.js'></script>
        
        <script type='text/javascript' src='/static/assets/js/plugins/knob/jquery.knob.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/sparkline/jquery.sparkline.min.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/flot/jquery.flot.js'></script>     
        <script type='text/javascript' src='/static/assets/js/plugins/flot/jquery.flot.resize.js'></script>

        <script type='text/javascript' src='/static/assets/js/plugins.js'></script>    
        <script type='text/javascript' src='/static/assets/js/actions.js'></script>
        <script type='text/javascript' src='/static/assets/js/settings.js'></script>
        <script type="text/javascript" src="/static/assets/js1/morris.js"></script>
        <script type="text/javascript" src="/static/assets/js1/raphael.js"></script>
        <script type='text/javascript' src='/static/assets/js/plugins/jquery/globalize.js'></script>
        <script type='text/javascript' src='/static/assets/js/plugins/stepy/jquery.stepy.min.js'></script>
        <script type="text/javascript" src="/static/js/user/dashboard.js"></script>
        <script type="text/javascript" src="/static/js/user/individual_portfolio.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    {% endblock %}
</head>

<script>
function del_cookie() {
                var cst = getCookie("csrftoken")
                var ssi = getCookie("sessionid")
                deleteCookie('cst')
                deleteCookie('ssi')
            }
</script>
<body onunload="del_cookie()">
    <div class="row" style="padding-left:20px">
        <div class="col-md-12">
            <ol class="breadcrumb" style="margin-top:33px">
                <li><div class="single-pane">
                    <h8 style="opacity: 1; text-align: center; font-weight: 100; text-shadow: rgba(0, 0, 0, 0.4) 3px 3px 3px; color: rgb(173, 234, 234); font-size: 28px;" helveticaneue-light",="" "helvetica="" neue="" light",="" neue";"=" id="splash">
                        <span style="letter-spacing:1px;"><i>V</i></span>ise
                    </h8>
                </div></li>
                <li><a href="#">Home</a></li>                    
                <li><a href="dashboard">Dashboard</a>
                </li>

            </ol>
        </div>
    </div>
    <div class="row" style="padding-left:20px;padding-right:20px">
        <div class="col-lg-2" style="width:275px">
            <div class="page-sidebar">
                <div class="page-navigation-panel">
                    <div class="name">Howdy, {{username}}</div>
                    <div class="control"><a href="#" class="psn-control"><span class="icon-reorder"></span></a></div>
                </div>            
                <div class="page-navigation-panel search">                                
                    <div class="input-group">                        
                        <input type="text" class="form-control" placeholder="Search...">
                        <div class="input-group-addon"><span class="icon-search"></span></div>
                    </div>                
                </div>
                <ul class="page-navigation">
                    <li>
                        <a href="/user/dashboard" class="stbar transition" id="/user/dashboard">
                            <span class="icon-home"></span> Dashboard
                        </a>
                    </li>                            
                    <li>
                        <a id="myPortfolios" href="#"><span class="icon-comments"></span> Messages</a>
                        <ul>                                    
                            <li><a href="/user/inbox">Inbox</a></li>
                            <li><a href="/user/sent">Sent</a></li>
                            <li><a href="/user/deleted">Deleted</a></li>
                            <li><a href="/user/starred">Starred</a></li>
                        </ul>                                
                    </li>
                    <li>
                        <a id="myPortfolios"> <span class="icon-folder-open-alt"></span>My Portfolios</a>
                      <ul>
                            <li>
                                <a class="stbar transition" href="/user/my_portfolios" id="/user/my_portfolios">Portfolio Summary </a>
                            </li>
                            <script>
                            function backtest(e) {
                                var url = String("/user/backtest/")
                                $.ajax({
                                    url: url,
                                    type: 'get',
                                    data: {'portName':e}
                                }).done(function(x) {
                                    var passedHtml = String(x.data)
                                    if (x.extras) {
                                        x.extras.forEach(function(a,i) {
                                            if (i == 0) {
                                                var newStr = "<div class='row highlightRow asset-row'><div class='col-sm-2 separateTop'>Asset "+a.number+"</div><div class='col-sm-3'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='"+a.symbol+"'>Select asset "+a.number+"</label></span><input type='text' id='"+a.symbol+"' name='"+a.symbol+"' class='form-control fmt-ticker' value='"+a.ticker+" maxlength='10' placeholder='Enter symbol' autocomplete='off' autocorrect='off' spellcheck='false''><span class='input-group-addon glyphicon glyphicon-search' title='Find ticker symbol'></span></div></div><div class='col-sm-2'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='allocation"+a.number+"_1'>Enter percentage allocation for asset "+a.number+" in portfolio 1</label></span><input type='text' id='allocation"+a.number+"_1' name='allocation"+a.number+"_1' class='form-control fmt-pct' maxlength='6' autocomplete='off' autocorrect='off' spellcheck='false' value='"+a.percentStock+"'><span class='input-group-addon'>%</span></div></div><div class='col-sm-2'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='allocation"+a.number+"_2'>Enter percentage allocation for asset "+a.number+" in portfolio 2</label></span><input type='text' id='allocation"+a.number+"_2' name='allocation"+a.number+"_2' class='form-control fmt-pct' maxlength='6' autocomplete='off' autocorrect='off' spellcheck='false'><span class='input-group-addon'>%</span></div></div><div class='col-sm-2'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='allocation"+a.number+"_3'>Enter percentage allocation for asset "+a.number+" in portfolio 3</label></span><input type='text' id='allocation"+a.number+"_3' name='allocation"+a.number+"_3' class='form-control fmt-pct' maxlength='6' autocomplete='off' autocorrect='off' spellcheck='false'><span class='input-group-addon'>%</span></div></div></div><div class='row topBorder'>"
                                                    passedHtml = passedHtml.replace(/(<div class="row topBorder">)/,newStr)
                                            } else {
                                                var newStr = "<div class='row highlightRow asset-row'><div class='col-sm-2 separateTop'>Asset "+a.number+"</div><div class='col-sm-3'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='"+a.symbol+"'>Select asset "+a.number+"</label></span><input type='text' id='"+a.symbol+"' name='"+a.symbol+"' class='form-control fmt-ticker' maxlength='10' placeholder='Enter symbol' autocomplete='off' autocorrect='off' spellcheck='false' value='"+a.ticker+"'><span class='input-group-addon glyphicon glyphicon-search' title='Find ticker symbol'></span></div></div><div class='col-sm-2'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='allocation"+a.number+"_1'>Enter percentage allocation for asset "+a.number+" in portfolio 1</label></span><input type='text' id='allocation"+a.number+"_1' name='allocation"+a.number+"_1' class='form-control fmt-pct' maxlength='6' autocomplete='off' autocorrect='off' spellcheck='false' value='"+a.percentStock+"'><span class='input-group-addon'>%</span></div></div><div class='col-sm-2'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='allocation"+a.number+"_2'>Enter percentage allocation for asset "+a.number+" in portfolio 2</label></span><input type='text' id='allocation"+a.number+"_2' name='allocation"+a.number+"_2' class='form-control fmt-pct' maxlength='6' autocomplete='off' autocorrect='off' spellcheck='false'><span class='input-group-addon'>%</span></div></div><div class='col-sm-2'><div class='input-group smallMargin'><span class='hidden_jaws'><label for='allocation"+a.number+"_3'>Enter percentage allocation for asset "+a.number+" in portfolio 3</label></span><input type='text' id='allocation"+a.number+"_3' name='allocation"+a.number+"_3' class='form-control fmt-pct' maxlength='6' autocomplete='off' autocorrect='off' spellcheck='false'><span class='input-group-addon'>%</span></div></div></div><div class='row topBorder'>"
                                                    passedHtml = passedHtml.replace(/(<div class='row topBorder'>)/,newStr)
                                            }
                                        })
                                    }
                                    var frame = $("iframe")
                                    contents = frame.contents()
                                    body = contents.find('body'),
                                    styleTag = contents
                                        .find('head')
                                        .append('<style></style>')
                                        .children('style')
                                    body.html(passedHtml)
                                })
                            }
                            </script>
                        {% for portfolio in portfolios %}
                            <li>
                                <div class="content list">
                                <div class="list-item" style="background:transparent">
                                    <div class="list-text">
                                        <!-- <p>{{portfolio.name}}</p> -->
                                        <a class="stbar transition" href="/user/individual_portfolio?q={{portfolio.name}}" id="/user/individual_portfolio">{{ portfolio.name }}</a>
                                    </div>
                                    <div class="list-controls" style="height: 78px; line-height: 28px; background-color:transparent">           
                                        <a href="#modal_wide_1" onClick="backtest(('{{portfolio.name}}'))" class="modal-wide btn btn-default btn-block btn-clean" style="background-color:rgba(0,0,0,0.7)"><center style="font-size:11px;">Run Backtest</center></a>
                                    </div>                    
                                </div>
                            </li>
                        {% endfor %}
                        </ul> 
                    </li>  
                    <li>
                        <a href="/user/portfolio_settings" class="stbar transition" id="/user/portfolio_settings"><span class="icon-plus"></span> Create a New Client Portfolio</a>
                    </li>
                    <li>
                        <a href="/user/news_portal" class="stbar transition" id="/user/news_portal"><span class="icon-flag-alt"></span> News & Sentiment</a>
                    </li>
                    <li>
                        <a href="/user/support" id="/user/support" class="stbar transition"><span class="icon-cogs"></span> Help & Suggestions</a>

                    </li>
                    <li>
                        <a href="/logout" id="/logout" class="stbar transition"><span class="icon-share-alt"></span> Log Out</a>
                    </li>                                                                   
                </ul>
            </div>
        </div>
        
        <div class="statusbar" id="statusbar_2" style="display: block;z-index:999;display:none;width:110vw">
            <div class="statusbar-icon"><img src="/static/img/loader.gif"></div>
            <div class="statusbar-text">Loading...</div>
            <div class="statusbar-close icon-remove"></div>
        </div>
        <div class="modal in" id="modal_wide_1" tabindex="-1" role="dialog" aria-hidden="false" style="display: block;display:none;height:110vh"><div class="modal-backdrop  in"></div>
                <div class="modal-dialog" style="width: 1647px; height: 926px; padding-top: 15px; padding-bottom: 15px;">
                    <script>
                        function refresh() {
                            location.assign('http://127.0.0.1:8000/user/dashboard')
                        }                    
                    </script>
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onClick="refresh()">×</button>
                            <h4 class="modal-title">Backtesting your portfolio</h4>
                            <span style="font-size:10px">Provided by PortfolioVisualizer @ Silicon Cloud Technologies LLc</span>
                        </div>
                        <div class="modal-body clearfix npr">
                            <div class="scroll mCustomScrollbar _mCS_2" style="height: 821px;"><div class="mCustomScrollBox mCS-light" id="mCSB_2" style="position:relative; height:100%; overflow:hidden; max-width:100%;"><div class="mCSB_container" style="position:relative; top:0;">
                                
                                <iframe style="width:100%;height:80vh"></iframe>
                                <!-- <iframe src="https://www.portfoliovisualizer.com/backtest-portfolio" style="width:100%;height:80vh"></iframe> -->

                            </div><div class="mCSB_scrollTools" style="position: absolute; display: block;"><div class="mCSB_draggerContainer"><div class="mCSB_dragger" style="position: absolute; top: 0px; height: 756px;" oncontextmenu="return false;"><div class="mCSB_dragger_bar" style="position: relative; line-height: 756px;"></div></div><div class="mCSB_draggerRail"></div></div></div></div></div>
                        </div>                
                    </div>
                </div>
            </div>
{% block content %}

{% endblock %}

{% block scripts %}
    <script type="text/javascript">
    $(".page-navigation li a").click(function(e){  
        if (e.currentTarget.id == 'myPortfolios') {
            var ul = $(this).parent('li').children('ul');
                if(ul.is(':visible')) {
                    setTimeout(function(){ 
                        ul.slideUp('fast');                
                    }, 100);
                } else {
                    setTimeout(function(){ 
                        ul.slideDown('fast');                
                    }, 100);

                }
        } else {
            $(".statusbar").show()
            setTimeout(function(){ 
                var url = e.currentTarget.id
                    console.log(url)
                    if (url) {
                    $("body").fadeOut(500, redirectPage(url))
                }
            }, 1000);
        };
        function redirectPage(url) {
            $("body").fadeOut(500, location.assign(url));      
            // window.location = url;
        }
    })
    </script>
{% endblock %}

</body>

</html>

