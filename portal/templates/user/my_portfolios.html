<!DOCTYPE html>
<html>

<head>
    <title>{% block title %}Vise{% endblock %}</title>    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block page_css %}
        <link rel="icon" type="image/ico" href="favicon.ico"/>
        <link href="/static/css/bootstrap.min.css" rel="stylesheet">
        <link href="/static/font-awesome/css/font-awesome.css" rel="stylesheet">
        <link href="/static/css/animate.css" rel="stylesheet">
        <link href="/static/css/style.css" rel="stylesheet">
        <link href="/static/css/fsai.css" rel="stylesheet">
        <link href="/static/css2/stylesheets.css" rel="stylesheet" type="text/css"/>   
        <link href="/static/css2/stylesheet.css" rel="stylesheet" type="text/css"/>   
    {% endblock %}
    {% block head %}
        <script type='text/javascript' src='/static/js/plugins/jquery/jquery.min.js'></script>
        <script type='text/javascript' src='/static/js/plugins/jquery/jquery-ui.min.js'></script>   
        <script type='text/javascript' src='/static/js/plugins/jquery/jquery-migrate.min.js'></script>
        <script type='text/javascript' src='/static/js/plugins/bootstrap/bootstrap.min.js'></script>
        <script type='text/javascript' src='/static/js/plugins/uniform/jquery.uniform.min.js'></script>
        <script type='text/javascript' src='/static/js/plugins/datatables/jquery.dataTables.min.js'></script>
        <script type='text/javascript' src='/static/js/plugins.js'></script>    
        <script type='text/javascript' src='/static/js/actions.js'></script>
        <script type='text/javascript' src='/static/js/settings.js'></script>
        
        <script type="text/javascript" src="/static/js1/morris.js"></script>
        <script type="text/javascript" src="/static/js1/raphael.js"></script>
        <script type='text/javascript' src='/static/js/plugins/jquery/globalize.js'></script>    

    {% endblock %}
</head>

<body>
<!-- Top Nav Bar -->
        <div class="row" style="padding-left:20px">
            <div class="col-md-12">
                <ol class="breadcrumb" style="margin-top:33px">
                    <li><a href="#">Home</a></li>                    
                    <li><a href="dashboard">Dashboard</a>
                    </li>

                </ol>
            </div>
        </div>
        <div class="row" style="padding-left:20px">
<!-- Left Hand Navi Menu -->
            <div class="col-lg-2" style="margin-top:50px">
                <div class="page-sidebar">
                    <div class="page-navigation-panel">
                        <div class="name">Howdy, {{user.username}}</div>
                        <div class="control"><a href="#" class="psn-control"><span class="icon-reorder"></span></a></div>
                    </div>            
                    <div class="page-navigation-panel search">                                
                        <div class="input-group">                        
                            <input type="text" class="form-control" placeholder="Search...">
                            <div class="input-group-addon"><span class="icon-search"></span></div>
                        </div>                
                    </div>
                    <ul class="page-navigation">
                        <li>
                            <a href="#statusbar_2" class="stbar" id="/user/dashboard">
                                <span class="icon-home"></span> Dashboard
                            </a>
                        </li>                            
                        <li>
                            <a id="myPortfolios" href="#statusbar_2"><span class="icon-comments"></span> Messages</a>
                            <ul>                                    
                                <li><a href="form_elements.html">Inbox</a></li>
                                <li><a href="form_editors.html">Sent</a></li>
                                <li><a href="form_files.html">Deleted</a></li>
                                <li><a href="form_validation.html">Starred</a></li>
                            </ul>                                
                        </li>
                        <li>
                            <a id="myPortfolios"> <span class="icon-folder-open-alt"></span>My Portfolios</a>
                          <ul>
                                <li><a href="/user/my_portfolios">Portfolio Summary </a></li>
                            {% for portfolio in all_portfolios %}
                                <li><a class="stbar" href="user/individual_portfolio/{{ portfolio.id }}">{{ portfolio.name }}</a></li>
                            {% endfor %}
                                <!--<li><a href="#statusbar_2" class="stbar" id="/user/my_portfolios">Portfolio Summary </a></li>
                                <li><a href="#statusbar_2" class="stbar" id="/user/Individual_portfolio">High Risk Portfolio</a></li>
                                <li><a href="#statusbar_2" class="stbar" id="/user/Individual_portfolio">European Portfolio</a></li>
                                <li><a href="#statusbar_2" class="stbar" id="/user/Individual_portfolio">Tech Portfolio</a></li>-->
                            </ul> 
                        </li>  
                        <li>
                            <a href="#statusbar_2" class="stbar" id="/user/portfolio_settings"><span class="icon-plus"></span> Create a New Portfolio</a>
                        </li>
                        <li>
                            <a href="/user/news_portal" class="stbar" id="/user/news_portal"><span class="icon-flag-alt"></span> News & Sentiment</a>
                        </li>
                        <li>
                            <a href="#"><span class="icon-cogs"></span> Help & Suggestions</a>

                        </li>
                        <li>
                            <a href="/logout"><span class="icon-share-alt"></span> Log Out</a>
                        </li>                                                                   
                    </ul>
                </div>
            </div>
            <div class="statusbar" id="statusbar_2" style="display: block;z-index:999;display:none;width:110vw">
                <div class="statusbar-icon"><img src="/static/img/loader.gif"></div>
                <div class="statusbar-text">Loading...</div>
                <div class="statusbar-close icon-remove"></div>
            </div>
        <div id="footer" class="footer" style="position:fixed;background-color:rgba(255,255,255,0);bottom:0px;border:0px">
            <a href="#" class="pull-right">Contact Us&nbsp;</a>
            <div style>
                <strong>Copyright</strong> VISE &copy; 2015
            </div>
        </div>    

<div class="col-md-8 col-sm-8" style="padding-left:50px;padding-right:50px">        
    {% for portfolio in all_portfolios %}
    <div class="block">
        <div class="header">
            <h2>{{ portfolio.name }}</h2>
            <span style="color:rgba(255,0,0,.6);float:right">{{ portfolio.risk}}% Risk </span>
        </div>
        <div class="content">
            <div id="DataTables_Table_2_wrapper" class="dataTables_wrapper" role="grid">
                <table cellpadding="0" cellspacing="0" width="100%" class="table table-bordered table-striped sortable dataTable" id="DataTables_Table_2" aria-describedby="DataTables_Table_2_info" style="width: 100%;">
                <thead>
                    <tr role="row">
                        <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" style="width: 18px;background-color:rgba(0,0,0,0)">Symbol</th>
                        <th width="25%" class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_2" rowspan="1" colspan="1" aria-label="ID: activate to sort column ascending" style="width: 237px;">Current Price</th>
                        <th width="25%" class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_2" rowspan="1" colspan="1" aria-label="Name: activate to sort column ascending" style="width: 241px;">Buy \ Sell Date</th><th width="25%" class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_2" rowspan="1" colspan="1" aria-label="E-mail: activate to sort column ascending" style="width: 245px;">Number of Shares</th><th width="25%" class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_2" rowspan="1" colspan="1" aria-label="Phone: activate to sort column ascending" style="width: 242px;">Initital Price</th>
                    </tr>
                </thead>
                
                <tbody role="alert" aria-live="polite" aria-relevant="all">
            {% if portfolio.stocks %}
                {% for stock in portfolio.stocks %}   
                    <tr class="even">
                        <td class=" sorting_1"><a href="#" id="stockLink"> {{ stock.ticker }} </a> </td>
                        <td class=" ">{{ stock.current_price }}<span id="priceChange"></span> </td>
                        <td class=" ">{{ stock.buy_date }} - {{ stock.sell_date }}</td>
                        <td class=" ">{{ stock.number_of_shares }}</td>
                        <td class=" ">{{ stock.initial_price }}</td>                                    
                    </tr>
                {% endfor %}
            {% endif %}                       
                </tbody></table>
                </div>                                        
        </div>
    </div>
    {% endfor %}
</div>
{% csrf_token %}
<form id="myForm" class="form-horizontal" action="/user/individual_stock" method="post" style="display:none">
<input type="text" class="form-control" id="company_name" value="company_name" name="company_name">    
<input type="text" class="form-control" id="ceo_name" value="ceo_name" name="ceo_name">    
<input type="text" class="form-control" id="ceo_rating" value="ceo_rating" name="ceo_rating">    
<input type="text" class="form-control" id="happiness_rating" value="happiness_rating" name="happiness_rating">    
<input type="text" class="form-control" id="culture_pros" value="culture_pros" name="culture_pros">    
<input type="text" class="form-control" id="culture_cons" value="culture_cons" name="culture_cons">    
</form>    
<script src="/static/js/nouislider.min.js"></script>
<script type="text/javascript">
$(".page-navigation li a").click(function(e){       
    var ul = $(this).parent('li').children('ul');
    
    if (e.currentTarget.id !== 'myPortfolios') {
        $(".statusbar").show()
        setTimeout(function(){ 
            var url = e.currentTarget.id
                console.log(url)
                if (url) {
                location.assign(url)
            }
        }, 2000);
    } else {
        console.log("asdf")
    }
});
</script>

<script type="text/javascript">
    var priceChanges = $("span#priceChange") 
    for (var key in priceChanges) {
        var obj = priceChanges[key]
        if (typeof(obj) == 'object' && obj.nodeName == 'SPAN') {
            console.log(obj)
            var percentage = (((parseFloat(obj.parentNode.outerText) - parseFloat(obj.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.innerText)) / parseFloat(obj.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.innerText))*100).toFixed(2)
            if (percentage > 0) {
                obj.innerHTML = "<span style='color:green'>" + (" + " + (((parseFloat(obj.parentNode.outerText) - parseFloat(obj.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.innerText)) / parseFloat(obj.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.innerText))*100).toFixed(2) + "%") + "</span>"
            } else {
                obj.innerHTML = "<span style='color:red'>" + (" - "+(((parseFloat(obj.parentNode.outerText) - parseFloat(obj.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.innerText)) / parseFloat(obj.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.innerText))*-100).toFixed(2) + "%") + "</span>"
            }
        }
    }
    $("a#stockLink").click(function(e){
        $(".statusbar")[0].innerText = "Loading " + e.currentTarget.innerText + "'s Stock Information ..."
        $(".statusbar").show()
        getStockInfo(e.currentTarget.innerText)
    });
    function getStockInfo(symbol) {
        var url = "http://d.yimg.com/aq/autoc?query=" + symbol + "&region=US&lang=en-US"
        var ahr = new XMLHttpRequest();
        ahr.onreadystatechange = function(){
            if (ahr.readyState==4 && ahr.status==200) 
            {
                var companyName = JSON.parse(ahr.responseText)
                console.log(companyName)
                companyName = companyName.ResultSet.Result[0].name
                var url = "http://api.glassdoor.com/api/api.htm?v=1&format=json&t.p=83856&t.k=cbW9p5pFQDw&action=employers&q=" + companyName
                var bhr = new XMLHttpRequest();
                bhr.onreadystatechange = function(){
                    if (ahr.readyState==4 && ahr.status==200) 
                    {
                        var data = JSON.parse(bhr.responseText)
                        $("#company_name")[0].value =  companyName
                        $("#ceo_name")[0].value =  data.response.employers[0].ceo.name
                        $("#ceo_rating")[0].value =  data.response.employers[0].ceo.pctApprove
                        $("#happiness_rating")[0].value =  data.response.employers[0].cultureAndValuesRating
                        $("#culture_pros")[0].value =  data.response.employers[0].featuredReview.pros
                        $("#culture_cons")[0].value =  data.response.employers[0].featuredReview.cons
                        document.forms["myForm"].submit();
                    }
                }
                bhr.open('GET',url,true);
                bhr.send();                                
            }
        }
        ahr.open('GET',url,true);
        ahr.send();
    };
    function companyNameFromSymbol(symbol) {
        var url = "http://d.yimg.com/aq/autoc?query=" + symbol + "&region=US&lang=en-US"
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function(){
            if (xhr.readyState==4 && xhr.status==200) 
            {  
                var companyName = JSON.parse(xhr.responseText)
                companyName = companyName.ResultSet.Result[0].name
                return companyName
            }
        }
        xhr.open('GET',url,true);
        xhr.send();                  
    };
    var rangeSlider = document.getElementById('basic_slider');
    
    noUiSlider.create(rangeSlider, {
        start: [30],
        range: {
            'min': [ 0 ],
            'max': [ 100 ]
        }
    });

    var rangeSliderValueElement = document.getElementById('basic_slider_value');
    var riskSliderRiskElement = document.getElementById('risk_slider_risk');

    rangeSlider.noUiSlider.on('update', function( values, handle ) {
        rangeSliderValueElement.innerHTML = values[handle] + "%";
        if(values[handle] < 30) {
            riskSliderRiskElement.innerHTML = "<p style='color:green;'>Low Risk</p>"
        } else if(values[handle] > 30 && values[handle] < 60) {
            riskSliderRiskElement.innerHTML = "<p style='color:orange;'>Medium Risk</p>"
        } else if (values[handle] > 60) {
            riskSliderRiskElement.innerHTML = "<p style='color:red;'>High Risk</p>"
        }
    });

    function stockChecker() {
        var stocksNumberElement = document.getElementById('stocks_number');
        if (stocksNumberElement.value > 10) { stocksNumberElement.value = 10} else if (stocksNumberElement.value < 3) { stocksNumberElement.value = 3}
    }

    function returnChecker() {
        var expReturnElement = document.getElementById('expReturn');
        if (expReturnElement.value > 50) { expReturnElement.value = 50} else if (expReturnElement.value < 1) { expReturnElement.value = 1}
    }

    function riskChecker() {
        var expRiskElement = document.getElementById('expRisk');
        if (expRiskElement.value > 20) { expRiskElement.value = 20} else if (expRiskElement.value < 1) { expRiskElement.value = 1}
    }

function popitup(url) {
    newwindow=window.open(url,'name','height=400,width=400');
    if (window.focus) {newwindow.focus()}
    return false;
}
</script>               




