{% extends "base.html" %}
{% block content %}
<script>
var url = String(window.location.href).slice(-2)
if (url[0] == '/') {
  url = url.slice(-1)
}
$("li#a" + url).attr('class','active')
</script>
<div class="sceneElement" data-viewport="0">
 <div class="nav">
    <a href="/user/portfolio_settings" data-target="-1" style=";margin-right:50px;float:right">           
      <h1><span class="icon-angle-right" style="display: inline-block;line-height: 90vh;position: fixed;top:50px;left:98vw;font-size:24px"></span></h1></a>
    <a href="/user/inbox" data-target="1" style=";margin-left:50px;float:left">
       <h1><span class="icon-angle-left" style="display: inline-block;line-height: 90vh;position: fixed;top:50px;left:1vw;font-size:24px"></span></h1>
    </a>
  </div>
<div class="col-lg-12 col-lg-12 col-sm-12" style="padding-right:25px;padding-left:25px;background:rgba(0,0,0,0.6);height:100%;padding-top:25px">

        <h2 style="font-weight:300;-webkit-font-smoothing: antialiased;font-family:'helvetica neue';letter-spacing:2px;font-size:24px;text-align:center;color:white" id="companyName">{{portfolio.name}}</h2> 

        <div class="block">
                    <div class="header">
                        <h2>Portfolio Returns Graph </h2>
                        <div class="side pull-right">                            
                            <ul class="buttons">
                                <li class="btn-group">                                    
                                    <a href="#" class="dropdown-toggle tip" title="" data-toggle="dropdown" data-original-title="More"><span class="icon-align-justify"></span></a>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#">Portfolio Details</a></li>
                                        <li><a href="#">Export portfolio as .CSV</a></li>
                                        <li><a href="#">Export performance as .CSV</a></li>  
                                    </ul>                                                                            
                                </li>
                                <li><a href="#" class="block-toggle tip" title="" data-original-title="Show"><span class="icon-chevron-down"></span></a></li>
                                <li><a href="#" class="block-remove tip" title="" data-original-title="Remove"><span class="icon-remove"></span></a></li>
                            </ul>
                        </div>                        
                    </div>                  
                    <div class="content" id="content{{portfolio.id}}" style="display:none;height:384px;overflow:hidden">
                  <h2 style="font-weight:300;-webkit-font-smoothing: antialiased;font-family:'helvetica neue';letter-spacing:2px;font-size:18px">Value : ${{portfolio.investment}}</h2>                        
                      <div class="loader{{portfolio.id}}" style="height:100%;text-align:center;top:35%;position:relative">
                        <img src="/static/img/loader.gif"><br><br>
                        <h2 style="font-weight:100;-webkit-font-smoothing: antialiased;font-family:'helvetica neue';letter-spacing:2px;font-size:18px">We are loading your portfolio data! This may take a minute..</h2>
                      </div>
<script>

(function() {
  var div = $("#content{{portfolio.id}}")
  console.log(div.width())
  var margin = {top: 30, right: 20, bottom: 100, left: 50},
    margin2  = {top: 210, right: 20, bottom: 20, left: 50},
    width    = div.width() - 75;
    height   = 283 - margin.top - margin.bottom,
    height2  = 283 - margin2.top - margin2.bottom;

  var parseDate = d3.time.format('%Y-%m-%d').parse,
    bisectDate = d3.bisector(function(d) { return d.date; }).left,
    legendFormat = d3.time.format('%Y %m, %d');

  var x = d3.time.scale().range([0, width]),
    x2  = d3.time.scale().range([0, width]),
    y   = d3.scale.linear().range([height, 0]),
    y1  = d3.scale.linear().range([height, 0]),
    y2  = d3.scale.linear().range([height2, 0]),
    y3  = d3.scale.linear().range([60, 0]);

  var xAxis = d3.svg.axis().scale(x).orient('bottom'),
    xAxis2  = d3.svg.axis().scale(x2).orient('bottom'),
    yAxis   = d3.svg.axis().scale(y).orient('left');

  var priceLine = d3.svg.line()
    .interpolate('monotone')
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.price); });

  var avgLine = d3.svg.line()
    .interpolate('monotone')
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.average); });

  var area2 = d3.svg.area()
    .interpolate('monotone')
    .x(function(d) { return x2(d.date); })
    .y0(height2)
    .y1(function(d) { return y2(d.price); });
  var svg = d3.select('#content{{portfolio.id}}')
    .append("div")
     .classed("svg-container", true) //container class to make it responsive
     .append("svg")
     .classed("svg-content-responsive", true)
     // .attr('class', 'chart')
     //responsive SVG needs these 2 attributes and no width and height attr
     .attr("preserveAspectRatio", "none")
     .attr("viewBox", "0 0 1600 325")
      .style("max-height", "265") 
      .style("min-height", "265") 
      .append("g")
      // .attr("transform", "translate(" 
      //     + margin.left 
      //     + "," + margin.top + ")");    
     //class to make it responsive
      // .attr('width', width + margin.left + margin.right)
      // .attr('height', height + margin.top + margin.bottom + 60)

  svg.append('defs').append('clipPath')
    .attr('id', 'clip')
  .append('rect')
    .attr('width', width)
    .attr('height', height);

  var make_y_axis = function () {
    return d3.svg.axis()
      .scale(y)
      .orient('left')
      .ticks(3);
  };

  var focus = svg.append('g')
    .attr('class', 'focus')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

  var barsGroup = svg.append('g')
    .attr('class', 'volume')
    .attr('clip-path', 'url(#clip)')
    .attr('transform', 'translate(' + margin.left + ',' + (margin.top + 60 + 20) + ')');

  var context = svg.append('g')
    .attr('class', 'context')
    .attr('transform', 'translate(' + margin2.left + ',' + (margin2.top + 60) + ')');

  var legend = svg.append('g')
    .attr('class', 'chart__legend')
    .attr('width', width)
    .attr('height', 30)
    .attr('transform', 'translate(' + margin2.left + ', 10)');

  legend.append('text')
    .attr('class', 'chart__symbol')
    .text('{{portfolio.name}}')
    .style('fill','white')

  var rangeSelection =  legend
    .append('g')
    .attr('class', 'chart__range-selection')
    .attr('transform', 'translate(110, 0)');
  d3.csv('/user/portfolio_chart/3', type, function(err, data) {
    var brush = d3.svg.brush()
      .x(x2)
      .on('brush', brushed);

    var xRange = d3.extent(data.map(function(d) { return d.date; }));

    x.domain(xRange);
    y.domain(d3.extent(data.map(function(d) { return d.price; })));
    y3.domain(d3.extent(data.map(function(d) { return d.price; })));
    x2.domain(x.domain());
    y2.domain(y.domain());

    var min = d3.min(data.map(function(d) { return d.price; }));
    var max = d3.max(data.map(function(d) { return d.price; }));

    var range = legend.append('text')
      .text(legendFormat(new Date(xRange[0])) + ' - ' + legendFormat(new Date(xRange[1])))
      .style('text-anchor', 'end')
      .style('fill','white')
      .attr('transform', 'translate(' + width + ', 0)');

    focus.append('g')
        .attr('class', 'y chart__grid')
        .call(make_y_axis()
        .tickSize(-width, 0, 0)
        .tickFormat(''));

    var averageChart = focus.append('path')
        .datum(data)
        .attr('class', 'chart__line chart__average--focus line')
        .attr('d', avgLine);

    var priceChart = focus.append('path')
        .datum(data)
        .attr('class', 'chart__line chart__price--focus line')
        .attr('d', priceLine);

    focus.append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0 ,' + height + ')')
        .style('fill','white')
        .call(xAxis);

    focus.append('g')
        .attr('class', 'y axis')
        .attr('transform', 'translate(12, 0)')
        .call(yAxis);

    var focusGraph = barsGroup.selectAll('rect')
        .data(data)
      .enter().append('rect')
        .attr('class', 'chart__bars')
        .attr('x', function(d, i) { return x(d.date); })
        .style('fill','white')
        .attr('y', function(d) { return 155 - y3(d.price); })
        .attr('width', 1)
        .attr('height', function(d) { return y3(d.price); });

    var helper = focus.append('g')
      .attr('class', 'chart__helper')
      .style('text-anchor', 'end')
      .style('fill','white')
      .style('font-size','24px')
      .attr('transform', 'translate(' + width + ', 0)');

    var helperText = helper.append('text')
        .style('fill','white')
    var priceTooltip = focus.append('g')
      .attr('class', 'chart__tooltip--price')
      .append('circle')
      .style('display', 'none')
      .attr('r', 2.5);

    var averageTooltip = focus.append('g')
      .attr('class', 'chart__tooltip--average')
      .append('circle')
      .style('display', 'none')
      .attr('r', 2.5);

    var mouseArea = svg.append('g')
      .attr('class', 'chart__mouse')
      .append('rect')
      .attr('class', 'chart__overlay')
      .attr('width', width)
      .attr('height', height)
      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
      .on('mouseover', function() {
        helper.style('display', null);
        priceTooltip.style('display', null);
        averageTooltip.style('display', null);
      })
      .on('mouseout', function() {
        helper.style('display', 'none');
        priceTooltip.style('display', 'none');
        averageTooltip.style('display', 'none');
      })
      .on('mousemove', mousemove);

    context.append('path')
        .datum(data)
        .attr('class', 'chart__area area')
        .attr('d', area2);

    context.append('g')
        .attr('class', 'x axis chart__axis--context')
        .attr('y', 0)
        .attr('transform', 'translate(0,' + (height2 - 22) + ')')
        .call(xAxis2);

    $(".loader{{portfolio.id}}").css('display','none')
    context.append('g')
        .attr('class', 'x brush')
        .call(brush)
      .selectAll('rect')
        .attr('y', -6)
        .attr('height', height2 + 7);
    function mousemove() {
      var x0 = x.invert(d3.mouse(this)[0]);
      var i = bisectDate(data, x0, 1);
      var d0 = data[i - 1];
      var d1 = data[i];
      var d = x0 - d0.date > d1.date - x0 ? d1 : d0;
      helperText.text(legendFormat(new Date(d.date)) + ' - Price: ' + d.price );
      priceTooltip.attr('transform', 'translate(' + x(d.date) + ',' + y(d.price) + ')');
      averageTooltip.attr('transform', 'translate(' + x(d.date) + ',' + y(d.average) + ')');
    }

    function brushed() {
      var ext = brush.extent();
      if (!brush.empty()) {
        x.domain(brush.empty() ? x2.domain() : brush.extent());
        y.domain([
          d3.min(data.map(function(d) { return (d.date >= ext[0] && d.date <= ext[1]) ? d.price : max; })),
          d3.max(data.map(function(d) { return (d.date >= ext[0] && d.date <= ext[1]) ? d.price : min; }))
        ]);
        range.text(legendFormat(new Date(ext[0])) + ' - ' + legendFormat(new Date(ext[1])))
        focusGraph.attr('x', function(d, i) { return x(d.date); });

        var days = Math.ceil((ext[1] - ext[0]) / (24 * 3600 * 1000))
        focusGraph.attr('width', (40 > days) ? (40 - days) * 5 / 6 : 5)
      }

      priceChart.attr('d', priceLine);
      averageChart.attr('d', avgLine);
      focus.select('.x.axis').call(xAxis);
      focus.select('.y.axis').call(yAxis);
    }

    var dateRange = ['1w', '1m', '3m', '6m', '1y']
    for (var i = 0, l = dateRange.length; i < l; i ++) {
      var v = dateRange[i];
      rangeSelection
        .append('text')
        .attr('class', 'chart__range-selection')
        .text(v)
        .style('fill','white')
        .attr('transform', 'translate(' + (18 * i) + ', 0)')
        .on('click', function(d) { focusOnRange(this.textContent); });
    }

    function focusOnRange(range) {
        console.log(range)
      var today = new Date(data[data.length - 1].date)
      var ext = new Date(data[data.length - 1].date)

      if (range === '1m')
        ext.setMonth(ext.getMonth() - 1)

      if (range === '1w')
        ext.setDate(ext.getDate() - 7)

      if (range === '3m')
        ext.setMonth(ext.getMonth() - 3)

      if (range === '6m')
        ext.setMonth(ext.getMonth() - 6)

      if (range === '1y')
        ext.setFullYear(ext.getFullYear() - 1)

      brush.extent([ext, today])
      brushed()
      context.select('g.x.brush').call(brush.extent([ext, today]))
    }

  })// end Data

  function type(d) {
    return {
      date    : parseDate(d.Date),
      price   : +d.Close,
      average : +d.Average,
      volume : +d.Volume,
    }


  }

}());
</script>

              
                    </div>
                    <div class="footer" style="width:95%;display:none;margin-right:25px;margin-left:25px">
<h2 style="font-size:18px;text-align:center;font-weight:300;-webkit-font-smoothing: antialiased;font-family:'helvetica neue'">{{portfolio.risk}}% Expected Risk on a {{portfolio.investment}}$ investment into {{portfolio.no_of_tickers}} shares.</h2>
                    </div>
                </div>                

    <div class="block">
    <div class="header">
        <h2 style="text-align:center;">{{ portfolio.name }}</h2>
    </div>
        <div class="content" style="background-color:rgba(0,0,0,0.6)">
                    <div id="pieChart" style="text-align:center;position:absolute;left:25px;display:inline;top:50x;width:50%"></div>
                <script>

var randomColor = (function(){
  var golden_ratio_conjugate = 0.618033988749895;
  var h = Math.random();

  var hslToRgb = function (h, s, l){
      var r, g, b;

      if(s == 0){
          r = g = b = l; // achromatic
      }else{
          function hue2rgb(p, q, t){
              if(t < 0) t += 1;
              if(t > 1) t -= 1;
              if(t < 1/6) return p + (q - p) * 6 * t;
              if(t < 1/2) return q;
              if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
              return p;
          }

          var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
          var p = 2 * l - q;
          r = hue2rgb(p, q, h + 1/3);
          g = hue2rgb(p, q, h);
          b = hue2rgb(p, q, h - 1/3);
      }

      return '#'+Math.round(r * 255).toString(16)+Math.round(g * 255).toString(16)+Math.round(b * 255).toString(16);
  };
  
  return function(){
    h += golden_ratio_conjugate;
    h %= 1;
    return hslToRgb(h, 0.5, 0.60);
  };
})();
var piewidth = document.getElementById("pieChart").offsetWidth

                var pie = new d3pie("pieChart", {
                    "header": {
                        "title": {
                            "text": "Stock Distribution",
                            "color": "#ffffff",
                            "fontSize": 24,
                            "": "helvetica"
                        },
                        "subtitle": {
                            "color": "#999999",
                            "fontSize": 12,
                            "font": "open sans"
                        },
                        "titleSubtitlePadding": 9
                    },
                    "footer": {
                        "color": "#999999",
                        "fontSize": 10,
                        "font": "open sans",
                        "location": "bottom-left"
                    },
                    "size": {
                        "canvasWidth": piewidth,
                        "pieOuterRadius": "90%"
                    },
                    "data": {
                        "sortOrder": "value-desc",
                        "content": [
                        {% for stock in stocks %}
                            {
                                "label": "{{stock.ticker}}",
                                "value": 2,
                                "color": randomColor()
                            },
                        {% endfor %}

                        ]
                    },
                    "labels": {
                        "outer": {
                            "pieDistance": 32
                        },
                        "inner": {
                            "hideWhenLessThanPercentage": 3
                        },
                        "mainLabel": {
                            "color": "#ffffff",
                            "fontSize": 11
                        },
                        "percentage": {
                            "color": "#ffffff",
                            "decimalPlaces": 0
                        },
                        "value": {
                            "color": "#adadad",
                            "fontSize": 11
                        },
                        "lines": {
                            "enabled": true
                        },
                        "truncation": {
                            "enabled": true
                        }
                    },
                    "effects": {
                        "pullOutSegmentOnClick": {
                            "effect": "linear",
                            "speed": 400,
                            "size": 8
                        }
                    },
                    "misc": {
                        "gradient": {
                            "enabled": false,
                            "percentage": 100
                        }
                    }
                });
                </script>

                               <div id="pieChart2" style="text-align:center;position:absolute;right:25px;display:inline;top:50px"></div>
                <script>
                
var randomColor = (function(){
  var golden_ratio_conjugate = 0.618033988749895;
  var h = Math.random();

  var hslToRgb = function (h, s, l){
      var r, g, b;

      if(s == 0){
          r = g = b = l; // achromatic
      }else{
          function hue2rgb(p, q, t){
              if(t < 0) t += 1;
              if(t > 1) t -= 1;
              if(t < 1/6) return p + (q - p) * 6 * t;
              if(t < 1/2) return q;
              if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
              return p;
          }

          var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
          var p = 2 * l - q;
          r = hue2rgb(p, q, h + 1/3);
          g = hue2rgb(p, q, h);
          b = hue2rgb(p, q, h - 1/3);
      }

      return '#'+Math.round(r * 255).toString(16)+Math.round(g * 255).toString(16)+Math.round(b * 255).toString(16);
  };
  
  return function(){
    h += golden_ratio_conjugate;
    h %= 1;
    return hslToRgb(h, 0.5, 0.60);
  };
})();
var piewidth = document.getElementById("pieChart").offsetWidth

                var pie = new d3pie("pieChart2", {
                    "header": {
                        "title": {
                            "text": "Sector Breakdown",
                            "color": "#ffffff",
                            "fontSize": 24,
                            "": "helvetica"
                        },
                        "subtitle": {
                            "color": "#999999",
                            "fontSize": 12,
                            "font": "open sans"
                        },
                        "titleSubtitlePadding": 9
                    },
                    "footer": {
                        "color": "#999999",
                        "fontSize": 10,
                        "font": "open sans",
                        "location": "bottom-left"
                    },
                    "size": {
                        "canvasWidth": piewidth,
                        "pieOuterRadius": "90%"
                    },
                    "data": {
                        "sortOrder": "value-desc",
                        "content": [
                            {
                                "label": "Technology",
                                "value": 232,
                                "color": randomColor()
                            },
                           {
                                "label": "Health",
                                "value": 432,
                                "color": randomColor()
                            },

                           {
                                "label": "Agriculture",
                                "value": 374,
                                "color": randomColor()
                            },


                        ]
                    },
                    "labels": {
                        "outer": {
                            "pieDistance": 32
                        },
                        "inner": {
                            "hideWhenLessThanPercentage": 3
                        },
                        "mainLabel": {
                            "color": "#ffffff",
                            "fontSize": 11
                        },
                        "percentage": {
                            "color": "#ffffff",
                            "decimalPlaces": 0
                        },
                        "value": {
                            "color": "#adadad",
                            "fontSize": 11
                        },
                        "lines": {
                            "enabled": true
                        },
                        "truncation": {
                            "enabled": true
                        }
                    },
                    "effects": {
                        "pullOutSegmentOnClick": {
                            "effect": "linear",
                            "speed": 400,
                            "size": 8
                        }
                    },
                    "misc": {
                        "gradient": {
                            "enabled": false,
                            "percentage": 100
                        }
                    }
                });
                </script>  

                <div class="blsock" style="width:100%;margin-top:500px">
                    <div class="input-group" style="width:100%;text-align:center">
                        <div class="btn-group btn-group-lg" style="text-align:center">

                        </div>              
                    </div>  
                </div>  
                <script>
                function backtest(id) {
                    $.ajax({
                        url:'/user/backtest/' + id,
                        dataType: 'json',
                        type: 'GET'
                    }).done(function(x) {
                        console.log(x)
                    })
                }
                </script>
                    <table class="table table-hover margin bottom">
                    <thead>
                    <tr>
                        <th>Market Ticker</th>
                        <th class="text-center">Company Name</th>
                        <th class="text-center">Buy Date</th>
                        <th class="text-center">Recommended Sell Date</th>
                        <th class="text-center">Market Sentiment</th>
                        <th class="text-center">Stock Price</th>
                        <th class="text-center">Percent gains</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for stock in stocks %}
                        <td><a href="#" onClick=goStock(this) id="stockLink">{{stock.ticker}}</a></td>
                        <td class="text-center small">{{stock.ticker}}</td>
                        <td class="text-center">{{stock.buy_date}}</td>
                        <td class="text-center">{{stock.sell_date}}</td>
                        <td class="text-center">{{market_sentiment | random }}</td>
                        <td class="text-center">{{stock.current_price}}</td>
{% if stock.gain >= 0%}
                         <td class="text-center" style="color:rgba(0,255,0,1)"><span style="font-size:20px;">&uarr;</span>&nbsp;{{ stock.gain }}%</td>
 {% else %}
                         <td class="text-center" style="color:rgba(255,0,0,1);"><span style="font-size:20px;">&darr;</span>&nbsp;{{ stock.gain }}%</td>
 {% endif %}

                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
    </div>                


<form id="myForm" class="form-horizontal" action="/user/individual_stock" method="post" style="display:none">
    {% csrf_token %}
    <input type="text" class="form-control" id="company_name" value="" name="company_name">    
</form>

</div>    

<!-- 
                <div class="block" style="position:relative;top:50px">
                    <ul class="nav nav-tabs" style="position:absolute;top:-40px;left:-5px;width:auto">
                        <li class=""><a href="/user/my_portfolios" data-toggle="tab" aria-expanded="true">
                            Portfolio Summary<br>
                           
                        </a></li>
            {% for portfolio in portfolios %}                          

                        <li class=""  id="a{{portfolio.id}}"><a href="/user/individual_portfolio/{{portfolio.id}}" data-toggle="tab" aria-expanded="false">{{ portfolio.name }}
        
                        </a></li>
            {% endfor %}
 
                    </ul>
                    <div class="content tab-content">
                        <div class="tab-pane active" id="tab8">
                            <p>

<form id="myForm" class="form-horizontal" action="/user/individual_stock" method="post" style="display:none">
    {% csrf_token %}
    <input type="text" class="form-control" id="company_name" value="" name="company_name">    
</form>


    <div class="block">
    <div class="header">
        <h2 style="text-align:center;">{{ portfolio.name }}</h2>
    </div>
        <div class="content" style="background-color:rgba(0,0,0,0.6)">
                    <div id="pieChart" style="text-align:center;position:absolute;left:25px;display:inline;top:50x"></div>
                <script>
                var colors = ["white","#87CEEB","rgb(79, 155, 43)","color: rgb(255, 152, 6)"," color: rgb(166, 45, 45);"]
                var pie = new d3pie("pieChart", {
                    "header": {
                        "title": {
                            "text": "Stock Distribution",
                            "color": "#ffffff",
                            "fontSize": 24,
                            "": "helvetica"
                        },
                        "subtitle": {
                            "color": "#999999",
                            "fontSize": 12,
                            "font": "open sans"
                        },
                        "titleSubtitlePadding": 9
                    },
                    "footer": {
                        "color": "#999999",
                        "fontSize": 10,
                        "font": "open sans",
                        "location": "bottom-left"
                    },
                    "size": {
                        "canvasWidth": 500,
                        "pieOuterRadius": "90%"
                    },
                    "data": {
                        "sortOrder": "value-desc",
                        "content": [
                        {% for stock in stocks %}
                            {
                                "label": "{{stock.ticker}}",
                                "value": 2,
                                "color": colors[{{ forloop.counter }}]
                            },
                        {% endfor %}

                        ]
                    },
                    "labels": {
                        "outer": {
                            "pieDistance": 32
                        },
                        "inner": {
                            "hideWhenLessThanPercentage": 3
                        },
                        "mainLabel": {
                            "color": "#ffffff",
                            "fontSize": 11
                        },
                        "percentage": {
                            "color": "#ffffff",
                            "decimalPlaces": 0
                        },
                        "value": {
                            "color": "#adadad",
                            "fontSize": 11
                        },
                        "lines": {
                            "enabled": true
                        },
                        "truncation": {
                            "enabled": true
                        }
                    },
                    "effects": {
                        "pullOutSegmentOnClick": {
                            "effect": "linear",
                            "speed": 400,
                            "size": 8
                        }
                    },
                    "misc": {
                        "gradient": {
                            "enabled": false,
                            "percentage": 100
                        }
                    }
                });
                </script>

                               <div id="pieChart2" style="text-align:center;position:absolute;right:25px;display:inline;top:50px"></div>
                <script>
                var colors = ["white","#87CEEB","rgb(79, 155, 43)","color: rgb(255, 152, 6)"," color: rgb(166, 45, 45);"]
                var pie = new d3pie("pieChart2", {
                    "header": {
                        "title": {
                            "text": "Sector Breakdown",
                            "color": "#ffffff",
                            "fontSize": 24,
                            "": "helvetica"
                        },
                        "subtitle": {
                            "color": "#999999",
                            "fontSize": 12,
                            "font": "open sans"
                        },
                        "titleSubtitlePadding": 9
                    },
                    "footer": {
                        "color": "#999999",
                        "fontSize": 10,
                        "font": "open sans",
                        "location": "bottom-left"
                    },
                    "size": {
                        "canvasWidth": 500,
                        "pieOuterRadius": "90%"
                    },
                    "data": {
                        "sortOrder": "value-desc",
                        "content": [
                            {
                                "label": "Technology",
                                "value": 232,
                                "color": colors[1]
                            },
                           {
                                "label": "Health",
                                "value": 432,
                                "color": colors[2]
                            },

                           {
                                "label": "Agriculture",
                                "value": 374,
                                "color": colors[3]
                            },


                        ]
                    },
                    "labels": {
                        "outer": {
                            "pieDistance": 32
                        },
                        "inner": {
                            "hideWhenLessThanPercentage": 3
                        },
                        "mainLabel": {
                            "color": "#ffffff",
                            "fontSize": 11
                        },
                        "percentage": {
                            "color": "#ffffff",
                            "decimalPlaces": 0
                        },
                        "value": {
                            "color": "#adadad",
                            "fontSize": 11
                        },
                        "lines": {
                            "enabled": true
                        },
                        "truncation": {
                            "enabled": true
                        }
                    },
                    "effects": {
                        "pullOutSegmentOnClick": {
                            "effect": "linear",
                            "speed": 400,
                            "size": 8
                        }
                    },
                    "misc": {
                        "gradient": {
                            "enabled": false,
                            "percentage": 100
                        }
                    }
                });
                </script>  

                <div class="blsock" style="width:100%;margin-top:500px">
                    <div class="input-group" style="width:100%;text-align:center">
                        <div class="btn-group btn-group-lg" style="text-align:center">

                        </div>              
                    </div>  
                </div>  
                <script>
                function backtest(id) {
                    $.ajax({
                        url:'/user/backtest/' + id,
                        dataType: 'json',
                        type: 'GET'
                    }).done(function(x) {
                        console.log(x)
                    })
                }
                </script>
                    <table class="table table-hover margin bottom">
                    <thead>
                    <tr>
                        <th>Market Ticker</th>
                        <th class="text-center">Company Name</th>
                        <th class="text-center">Buy Date</th>
                        <th class="text-center">Recommended Sell Date</th>
                        <th class="text-center">Market Sentiment</th>
                        <th class="text-center">Stock Price</th>
                        <th class="text-center">Percent gains</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for stock in stocks %}
                        <td><a href="#" onClick=goStock(this) id="stockLink">{{stock.ticker}}</a></td>
                        <td class="text-center small">{{stock.ticker}}</td>
                        <td class="text-center">{{stock.buy_date}}</td>
                        <td class="text-center">{{stock.sell_date}}</td>
                        <td class="text-center">{{market_sentiment | random }}</td>
                        <td class="text-center">{{stock.current_price}}</td>
{% if stock.gain >= 0%}
                         <td class="text-center" style="color:rgba(0,255,0,1)"><span style="font-size:20px;">&uarr;</span>&nbsp;{{ stock.gain }}%</td>
 {% else %}
                         <td class="text-center" style="color:rgba(255,0,0,1);"><span style="font-size:20px;">&darr;</span>&nbsp;{{ stock.gain }}%</td>
 {% endif %}

                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
    </div>


   </div>
</div>
</div>

                    <tr>
 -->

</body>

{% endblock %}
{% block scripts %}
<link href="/static/css2/d3.pie.css" rel="stylesheet">
 <script src="/static/js/user/individual_portfolio.js"></script>


{% endblock %}
